<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guestbook App</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .version { background: #f0f0f0; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .message { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üìñ –ì–æ—Å—Ç–µ–≤–∞—è –∫–Ω–∏–≥–∞</h1>
    
    <div class="version">
        <strong>–í–µ—Ä—Å–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:</strong> <span id="frontend-version">frontend-v1.0</span>
    </div>
    
    <div id="backend-version" class="version">
        <strong>–í–µ—Ä—Å–∏—è –±—ç–∫–µ–Ω–¥–∞:</strong> –ó–∞–≥—Ä—É–∑–∫–∞...
    </div>
    
    <div id="messages">
        <h2>–°–æ–æ–±—â–µ–Ω–∏—è:</h2>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>
    </div>
    
    <h2>–î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:</h2>
    <form id="message-form">
        <input type="text" id="author" placeholder="–í–∞—à–µ –∏–º—è" style="width: 200px; padding: 8px; margin: 5px;">
        <br>
        <textarea id="message" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" style="width: 400px; height: 100px; padding: 8px; margin: 5px;"></textarea>
        <br>
        <button type="submit" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px;">
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
        </button>
    </form>
    
    <script>
        const API_URL = 'https://–≤–∞—à-gateway-id.apigw.yandexcloud.net/api';
        
        async function loadBackendInfo() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                document.getElementById('backend-version').innerHTML = 
                    `<strong>–í–µ—Ä—Å–∏—è –±—ç–∫–µ–Ω–¥–∞:</strong> ${data.backend_version}`;
            } catch (error) {
                document.getElementById('backend-version').innerHTML = 
                    `<strong>–í–µ—Ä—Å–∏—è –±—ç–∫–µ–Ω–¥–∞:</strong> –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏`;
            }
        }
        
        async function loadMessages() {
            try {
                const response = await fetch(`${API_URL}/messages`);
                const data = await response.json();
                
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML = '<h2>–°–æ–æ–±—â–µ–Ω–∏—è:</h2>';
                
                if (data.messages && data.messages.length > 0) {
                    data.messages.forEach(msg => {
                        const msgDiv = document.createElement('div');
                        msgDiv.className = 'message';
                        msgDiv.innerHTML = `
                            <strong>${msg.author}</strong> 
                            <small>(${new Date(msg.timestamp).toLocaleString()})</small>
                            <p>${msg.message}</p>
                        `;
                        messagesDiv.appendChild(msgDiv);
                    });
                } else {
                    messagesDiv.innerHTML += '<div>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</div>';
                }
            } catch (error) {
                console.error('Error loading messages:', error);
            }
        }
        
        document.getElementById('message-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const author = document.getElementById('author').value || '–ê–Ω–æ–Ω–∏–º';
            const message = document.getElementById('message').value;
            
            if (!message.trim()) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/messages`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ author, message })
                });
                
                if (response.ok) {
                    document.getElementById('message').value = '';
                    loadMessages();
                }
            } catch (error) {
                console.error('Error sending message:', error);
            }
        });
        
        loadBackendInfo();
        loadMessages();
    </script>
</body>
</html>